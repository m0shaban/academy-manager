# ๐ ุฏููู ุงูู API - ูุธุงู ุฅุฏุงุฑุฉ ุงูุฃูุงุฏูููุฉ v4.1

## ๐ ูุธุงู ุงูุฃูุงู ูุงููุตุงุฏูุฉ

### ๐ ููุฏ ุงููุฏูุฑ ุงูุซูุงุซู

ูุญูุงูุฉ ูุตููุ ูุณุชุฎุฏู ุงููุธุงู ููุฏ ูุฏูุฑ ูู 3 ุฎุทูุงุช:

- **ุงูุฎุทูุฉ 1**: ุจูุญ
- **ุงูุฎุทูุฉ 2**: ุทุฑุญ
- **ุงูุฎุทูุฉ 3**: ููุฒ

## ๐ซ API ุชูููุฏ ุงูุฃููุงุฏ

### `POST /gen-vouchers`

**ุงููุตู**: ุชูููุฏ ุฃููุงุฏ ุงุดุชุฑุงู ุฌุฏูุฏุฉ

**ุงููุตุงุฏูุฉ**: ููุฏ ุงููุฏูุฑ ุงูุซูุงุซู

**ุงูุทูุจ**:

```json
{
  "step1": "ุจูุญ",
  "step2": "ุทุฑุญ",
  "step3": "ููุฒ",
  "count": 20,
  "duration_days": 30
}
```

**ุงูุงุณุชุฌุงุจุฉ ุงููุงุฌุญุฉ** (200):

```json
{
  "status": "ok",
  "count": 20,
  "duration_days": 30,
  "codes": ["ABC123XYZ", "DEF456UVW", "GHI789RST"]
}
```

**ุงูุงุณุชุฌุงุจุฉ ุนูุฏ ุงูุฎุทุฃ** (401):

```json
{
  "status": "error",
  "message": "ููุฏ ุงููุฏูุฑ ุบูุฑ ุตุญูุญ - ุชุฃูุฏ ูู ุงูุฎุทูุงุช ุงูุซูุงุซ"
}
```

## ๐ API ุชูุนูู ุงูุงุดุชุฑุงู

### `POST /activate`

**ุงููุตู**: ุชูุนูู ุงุดุชุฑุงู ูุณุชุฎุฏู ุจุงุณุชุฎุฏุงู ููุฏ

**ุงููุตุงุฏูุฉ**: ุจุฏูู (ุนุงู ูููุณุชุฎุฏููู)

**ุงูุทูุจ**:

```json
{
  "user_id": "facebook_user_12345",
  "code": "ABC123XYZ"
}
```

**ุงูุงุณุชุฌุงุจุฉ ุงููุงุฌุญุฉ** (200):

```json
{
  "status": "activated",
  "subscription_end": "2026-02-12T10:30:00.000Z"
}
```

**ุงูุงุณุชุฌุงุจุฉ ุนูุฏ ุงูุฎุทุฃ** (400):

```json
{
  "status": "error",
  "message": "ุงูููุฏ ุบูุฑ ุตุญูุญ ุฃู ูุณุชุฎุฏู ุจุงููุนู"
}
```

## ๐ API ูุญุต ุญุงูุฉ ุงูุงุดุชุฑุงู

### `GET /subscription-status?user_id=USER_ID`

**ุงููุตู**: ูุญุต ุญุงูุฉ ุงุดุชุฑุงู ุงููุณุชุฎุฏู

**ุงููุนุงููุงุช**:

- `user_id` (ูุทููุจ): ูุนุฑู ุงููุณุชุฎุฏู
- `secret` (ุงุฎุชูุงุฑู): ููุชุงุญ ุณุฑู ูููุตูู ุงูุฅุฏุงุฑู

**ุงูุงุณุชุฌุงุจุฉ ุงููุดุทุฉ** (200):

```json
{
  "status": "active",
  "active": true,
  "subscription_end": "2026-02-12T10:30:00.000Z"
}
```

**ุงูุงุณุชุฌุงุจุฉ ุงูููุชููุฉ ุงูุตูุงุญูุฉ** (200):

```json
{
  "status": "expired",
  "active": false,
  "subscription_end": "2025-12-01T10:30:00.000Z"
}
```

## ๐ APIs ุงูุฅุฏุงุฑุฉ ูุงูุชุญุฏูุซ

### `POST /update-config?secret=SECRET_KEY`

**ุงููุตู**: ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ุงูุจูุช

**ุงููุตุงุฏูุฉ**: ููุชุงุญ ุณุฑู

**ุงูุทูุจ**:

```json
{
  "active_hours": [9, 11, 14, 17, 20, 22],
  "mood": "ุญูุงุณู ุฌุฏุงู",
  "rss_feeds": ["https://example.com/feed1", "https://example.com/feed2"]
}
```

### `GET /status`

**ุงููุตู**: ูุญุต ุญุงูุฉ ุงููุธุงู ุงูุนุงูุฉ

**ุงูุงุณุชุฌุงุจุฉ**:

```json
{
  "status": "running",
  "time_cairo": "2026-01-12 15:30:00",
  "active_hours": [9, 11, 14, 17, 20, 22],
  "rss_count": 30,
  "mood": "ุญูุงุณู ุฌุฏุงู",
  "last_post_hour": 14
}
```

## ๐พ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู ุงููุณุชุฎุฏููู (`users`)

```sql
CREATE TABLE users (
    user_id TEXT PRIMARY KEY,
    subscription_end TEXT,
    created_at TEXT
);
```

### ุฌุฏูู ุงูุฃููุงุฏ (`vouchers`)

```sql
CREATE TABLE vouchers (
    code TEXT PRIMARY KEY,
    duration_days INTEGER NOT NULL,
    is_used INTEGER DEFAULT 0,
    used_by TEXT,
    created_at TEXT,
    used_at TEXT
);
```

## ๐ก๏ธ ุฏูุงู ุงูุญูุงูุฉ

### `is_premium(user_id: str) -> bool`

ูุญุต ูุง ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุฏูู ุงุดุชุฑุงู ูุดุท

### `activate_voucher(user_id: str, code: str) -> (bool, str)`

ุชูุนูู ููุฏ ุงุดุชุฑุงู ูููุณุชุฎุฏู

### `generate_vouchers(count: int, duration_days: int) -> List[str]`

ุชูููุฏ ูุฌููุนุฉ ูู ุฃููุงุฏ ุงูุงุดุชุฑุงู

## ๐ง ุฃูุซูุฉ ุงูุชุทุจูู

### Python (Requests)

```python
import requests

# ุชูููุฏ ุฃููุงุฏ
response = requests.post(
    "http://localhost:5000/gen-vouchers",
    json={
        "step1": "ุจูุญ",
        "step2": "ุทุฑุญ",
        "step3": "ููุฒ",
        "count": 10,
        "duration_days": 30
    }
)

# ุชูุนูู ุงุดุชุฑุงู
response = requests.post(
    "http://localhost:5000/activate",
    json={
        "user_id": "user123",
        "code": "ABC123XYZ"
    }
)

# ูุญุต ุงูุญุงูุฉ
response = requests.get(
    "http://localhost:5000/subscription-status?user_id=user123"
)
```

### JavaScript (Fetch)

```javascript
// ุชูููุฏ ุฃููุงุฏ
fetch('/gen-vouchers', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    step1: 'ุจูุญ',
    step2: 'ุทุฑุญ',
    step3: 'ููุฒ',
    count: 10,
    duration_days: 30,
  }),
})
  .then((response) => response.json())
  .then((data) => console.log(data));
```

## ๐ ุฑููุฒ ุงูุฎุทุฃ

| ุฑูุฒ | ุงููุตู               | ุงูุญู                                |
| --- | ------------------- | ----------------------------------- |
| 401 | ููุฏ ุงููุฏูุฑ ุบูุฑ ุตุญูุญ | ุชุฃูุฏ ูู ุงูุฎุทูุงุช ุงูุซูุงุซ              |
| 400 | ุจูุงูุงุช ุงูุทูุจ ูุงูุตุฉ  | ุชุฃูุฏ ูู ุฅุฑุณุงู ูู ุงููุนุงููุงุช ุงููุทููุจุฉ |
| 404 | ุงููุณุงุฑ ุบูุฑ ููุฌูุฏ    | ุชุฃูุฏ ูู URL ุงูุตุญูุญ                  |
| 500 | ุฎุทุฃ ูู ุงูุฎุงุฏู       | ุชุญูู ูู logs ุงูุฎุงุฏู                 |

---

๐ **ุฃูุงู ูุตูู** | ๐ **ูุซุงุฆู ุดุงููุฉ** | ๐ **ุฌุงูุฒ ููุฅูุชุงุฌ**
